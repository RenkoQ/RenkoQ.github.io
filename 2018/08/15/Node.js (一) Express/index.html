<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    
    <title>Node.js (一) Express | Renko&#39;s blog | 人生如逆旅，我亦是行人</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="后台">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.1.2">
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":true,"app_id":"BG0bK4DLNxackBrBBd7M3TOI-gzGzoHsz","app_key":"ji1U1fUbF7iiD8xufT3rvonA","icon":true}'),
            v: JSON.parse('{"enable":true,"appid":"BG0bK4DLNxackBrBBd7M3TOI-gzGzoHsz","appkey":"ji1U1fUbF7iiD8xufT3rvonA","notify":false,"verify":true,"placeholder":"欢迎留言...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Renko</h5>
          <a href="mailto:fqx2@outlook.com" title="fqx2@outlook.com" class="mail">fqx2@outlook.com</a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/RenkoQ" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friend"  >
                <i class="icon icon-lg icon-group"></i>
                友链
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://sunnyfu.cn"  >
                <i class="icon icon-lg icon-anchor"></i>
                简历
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Node.js (一) Express</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header" style="background-image: url(img/banner.jpg)">
    <div class="container fade-scale">
        <h1 class="title">Node.js (一) Express</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-08-15T03:26:30.000Z" itemprop="datePublished" class="page-time">
  2018-08-15
</time>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-Node.js (一) Express"
  class="post-article article-type-post fade" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Node.js (一) Express</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-08-15 11:26:30" datetime="2018-08-15T03:26:30.000Z"  itemprop="datePublished">2018-08-15</time>

            


            
	<span id="/2018/08/15/Node.js (一) Express/" class="leancloud_visitors" data-flag-title="Node.js (一) Express" title="Node.js (一) Express">
		
			<i class="icon icon-eye"></i>
		
		<span class="leancloud-visitors-count"></span>
	</span>
 

            
    <span>
        <i class="icon icon-comment-o"></i>
        <a href="/2018/08/15/Node.js (一) Express/#comment">
            <span class="valine-comment-count" data-xid="/2018/08/15/Node.js (一) Express/"></span>
        </a>
    </span>


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p><a href="https://github.com/nswbmw/N-blog/" target="_blank" rel="noopener">https://github.com/nswbmw/N-blog/</a></p>
<h3 id="1-环境变量"><a href="#1-环境变量" class="headerlink" title="1. 环境变量"></a>1. 环境变量</h3><p><code>环境变量（environment variables）</code>一般是指在操作系统中用来指定操作系统运行环境的一些参数。</p>
<p>简单来讲，环境变量就是传递参数给运行程序的。</p>
<pre><code>env  //显示环境变量
</code></pre><p>nodejs使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=test node app</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(process.env.NODE_ENV) <span class="comment">//test</span></span><br></pre></td></tr></table></figure>
<p>debug模块使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DEBUG=* node app</span><br><span class="line"></span><br><span class="line">-------</span><br><span class="line"><span class="comment">//windows用户设置</span></span><br><span class="line"></span><br><span class="line">set DEBUG=*</span><br><span class="line">set NODE_ENV=test</span><br><span class="line">node app</span><br></pre></td></tr></table></figure>
<p><a href="https://www.npmjs.com/package/cross-env" target="_blank" rel="noopener">cross-env</a></p>
<pre><code>Run scripts that set and use environment variables across platforms
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cross-env NODE_ENV=test node app</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="2-package-json"><a href="#2-package-json" class="headerlink" title="2. package.json"></a>2. package.json</h3><p><a href="https://docs.npmjs.com/files/package.json" target="_blank" rel="noopener">https://docs.npmjs.com/files/package.json</a></p>
<p><code>语义化版本（semver）</code>即 dependencies、devDependencies 和 peerDependencies 里的如：<code>&quot;co&quot;: &quot;^4.6.0&quot;</code>。</p>
<p><a href="http://semver.org/lang/zh-CN/" target="_blank" rel="noopener">http://semver.org/lang/zh-CN/</a></p>
<p>semver 格式：<code>主版本号.次版本号.修订号</code>。版本号递增规则如下：</p>
<ul>
<li><code>主版本号</code>：做了不兼容的 API 修改</li>
<li><code>次版本号</code>：做了向下兼容的功能性新增</li>
<li><code>修订号</code>：做了向下兼容的 bug 修正</li>
</ul>
<h3 id="3-npm操作"><a href="#3-npm操作" class="headerlink" title="3. npm操作"></a>3. npm操作</h3><h4 id="搜索npm模块"><a href="#搜索npm模块" class="headerlink" title="搜索npm模块"></a>搜索npm模块</h4><ul>
<li><a href="http://npmjs.com" target="_blank" rel="noopener">http://npmjs.com</a>(npm 官网)</li>
<li><a href="http://node-modules.com" target="_blank" rel="noopener">http://node-modules.com</a></li>
<li><a href="https://npms.io" target="_blank" rel="noopener">https://npms.io</a></li>
<li><a href="https://nodejsmodules.org" target="_blank" rel="noopener">https://nodejsmodules.org</a></li>
</ul>
<h4 id="1-npm-init"><a href="#1-npm-init" class="headerlink" title="1. npm init"></a>1. npm init</h4><p>初始化一个空项目</p>
<h4 id="2-npm-install"><a href="#2-npm-install" class="headerlink" title="2. npm install"></a>2. npm install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -h</span><br><span class="line"></span><br><span class="line">npm install (with no args, <span class="keyword">in</span> package dir)</span><br><span class="line">npm install [&lt;@scope&gt;/]&lt;pkg&gt;</span><br><span class="line">npm install [&lt;@scope&gt;/]&lt;pkg&gt;@&lt;tag&gt;</span><br><span class="line">npm install [&lt;@scope&gt;/]&lt;pkg&gt;@&lt;version&gt;</span><br><span class="line">npm install [&lt;@scope&gt;/]&lt;pkg&gt;@&lt;version range&gt;</span><br><span class="line">npm install &lt;folder&gt;</span><br><span class="line">npm install &lt;tarball file&gt;</span><br><span class="line">npm install &lt;tarball url&gt;</span><br><span class="line">npm install &lt;git:// url&gt;</span><br><span class="line">npm install &lt;github username&gt;/&lt;github project&gt;</span><br><span class="line"></span><br><span class="line">aliases: i, isntall, add</span><br><span class="line">common options: [--save-prod|--save-dev|--save-optional] [--save-exact] [--no-save]</span><br></pre></td></tr></table></figure>
<p>直接使用 <code>npm i</code> 安装的模块是不会写入 <code>package.json</code> 的 dependencies (或 devDependencies)，需要额外加个参数:</p>
<blockquote>
<ol>
<li><code>npm i express --save</code>/<code>npm i express -S</code><br>(安装 express，同时将 <code>&quot;express&quot;: &quot;^4.14.0&quot;</code> 写入 dependencies )</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li><code>npm i express --save-dev</code>/<code>npm i express -D</code><br>(安装 express，同时将 <code>&quot;express&quot;: &quot;^4.14.0&quot;</code> 写入 devDependencies )</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li><code>npm i express --save --save-exact</code><br>(安装 express，同时将固定版本号 <code>&quot;express&quot;: &quot;4.14.0&quot;</code> 写入 dependencies )</li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set save-exact true</span><br></pre></td></tr></table></figure>
<p>这样每次 <code>npm i xxx --save</code> 的时候会锁定依赖的版本号，相当于加了 <code>--save-exact</code> 参数。(<code>npm config set</code> 命令将配置写到了 <code>~/.npmrc</code> 文件，运行 <code>npm config list</code>查看。)</p>
<h4 id="3-npm-scripts"><a href="#3-npm-scripts" class="headerlink" title="3. npm scripts"></a>3. npm scripts</h4><p><a href="https://docs.npmjs.com/misc/scripts" target="_blank" rel="noopener">npm scripts</a></p>
<p><code>npm start</code> 等价于<code>npm run start</code><br><code>npm test</code> 等价于 <code>npm run test</code></p>
<h4 id="4-npm-shrinkwrap"><a href="#4-npm-shrinkwrap" class="headerlink" title="4. npm shrinkwrap"></a>4. npm shrinkwrap</h4><p><a href="https://docs.npmjs.com/cli/shrinkwrap" target="_blank" rel="noopener">npm-shrinkwrap</a></p>
<p>运行后会在当前目录下产生一个 <code>npm-shrinkwrap.json</code>，里面包含了通过 <code>node_modules</code> 计算出的模块的依赖树及版本。</p>
<p>只要目录下有 <code>npm-shrinkwrap.json</code> 则运行 <code>npm install</code> 的时候会优先使用 <code>npm-shrinkwrap.json</code> 进行安装，没有则使用 <code>package.json</code> 进行安装。</p>
<p><code>npm shrinkwrap</code> 只会生成 dependencies 的依赖，不会生成 devDependencies 的。</p>
<h3 id="4-初始化express项目"><a href="#4-初始化express项目" class="headerlink" title="4. 初始化express项目"></a>4. 初始化express项目</h3><p><a href="http://expressjs.com/en/4x/api.html" target="_blank" rel="noopener">express官方文档</a></p>
<p><code>npm init</code></p>
<p><code>npm i express --save</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'hello, express'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>运行 <code>node index</code>，打开浏览器访问 <code>localhost:3000</code> 时，页面应显示 <code>hello, express</code>。</p>
<h3 id="5-node-supervisor"><a href="#5-node-supervisor" class="headerlink" title="5. node-supervisor"></a>5. node-supervisor</h3><p><a href="https://www.npmjs.com/package/supervisor" target="_blank" rel="noopener">node-supervisor</a></p>
<pre><code>A little supervisor script for nodejs. It runs your program, and watches for code changes, so you can have hot-code reloading-ish behavior, without worrying about memory leaks and making sure you clean up all the inter-module references, and without a whole new require system.
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g supervisor</span><br></pre></td></tr></table></figure>
<p>运行 <code>supervisor index</code> 启动程序, supervisor 会监听当前目录下 node 和 js 后缀的文件，当这些文件发生改动时，supervisor 会自动重启程序。</p>
<h3 id="6-路由匹配"><a href="#6-路由匹配" class="headerlink" title="6. 路由匹配"></a>6. 路由匹配</h3><p><a href="https://www.npmjs.com/package/path-to-regexp" target="_blank" rel="noopener">Path-to-RegExp</a></p>
<pre><code>Turn a path string such as /user/:name into a regular expression.
</code></pre><p>express 使用了 <code>path-to-regexp</code> 模块实现的路由匹配。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/users/:name'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'hello, '</span> + req.params.name)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>req 包含了请求来的相关信息，res 则用来返回该请求的响应。</p>
<h4 id="常用的-req-的属性："><a href="#常用的-req-的属性：" class="headerlink" title="常用的 req 的属性："></a>常用的 req 的属性：</h4><p><strong>req.query</strong>:<br>解析 url 中的<code>querystring</code>，如 <code>?name=haha</code>，req.query 的值为 <code>{name: &#39;haha&#39;}</code></p>
<p><strong>req.params</strong>:<br>解析 url 中的占位符，如 <code>/:name</code>，访问 <code>/haha</code>，req.params 的值为 <code>{name: &#39;haha&#39;}</code></p>
<p><strong>req.body</strong>:<br>解析后请求体，需使用相关的模块，如 <code>body-parser</code>，请求体为 <code>{&quot;name&quot;: &quot;haha&quot;}</code>，则 req.body 为 <code>{name: &#39;haha&#39;}</code></p>
<h4 id="express-Router"><a href="#express-Router" class="headerlink" title="express.Router"></a>express.Router</h4><p><a href="http://expressjs.com/en/4x/api.html#router" target="_blank" rel="noopener">express.Router</a></p>
<p>创建空文件夹 routes，在 routes 目录下创建 index.js 和 users.js。最后代码如下：</p>
<p><strong>index.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"><span class="keyword">const</span> indexRouter = <span class="built_in">require</span>(<span class="string">'./routes/index'</span>)</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">'./routes/users'</span>)</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/'</span>, indexRouter)</span><br><span class="line">app.use(<span class="string">'/users'</span>, userRouter)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p><strong>routes/index.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'hello, express'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>
<p><strong>routes/users.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/:name'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'hello, '</span> + req.params.name)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>
<p>以上代码的意思是：我们将 <code>/</code> 和 <code>/users/:name</code> 的路由分别放到了 routes/index.js 和 routes/users.js 中，<em>每个路由文件通过生成一个 express.Router 实例 router 并导出，通过 <code>app.use</code> 挂载到不同的路径</em>。这两种代码实现了相同的功能，但在实际开发中推荐使用 express.Router 将不同的路由分离到不同的路由文件中。</p>
<h3 id="7-模板引擎ejs"><a href="#7-模板引擎ejs" class="headerlink" title="7. 模板引擎ejs"></a>7. 模板引擎ejs</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i ejs --save</span><br></pre></td></tr></table></figure>
<p><strong>index.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"><span class="keyword">const</span> indexRouter = <span class="built_in">require</span>(<span class="string">'./routes/index'</span>)</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">'./routes/users'</span>)</span><br><span class="line"></span><br><span class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>))<span class="comment">// 设置存放模板文件的目录</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>)<span class="comment">// 设置模板引擎为 ejs</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/'</span>, indexRouter)</span><br><span class="line">app.use(<span class="string">'/users'</span>, userRouter)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>通过 <code>app.set</code> 设置模板引擎为 ejs 和存放模板的目录。<br>在 myblog 下新建 views 文件夹，在 views 下新建 <code>users.ejs</code>，添加如下代码：</p>
<p><strong>views/users.ejs</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      body &#123;padding: 50px;font: 14px "Lucida Grande", Helvetica, Arial, sans-serif;&#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name.toUpperCase</span>() %&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello, <span class="tag">&lt;<span class="name">%=</span> <span class="attr">name</span> %&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>routes/users.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/:name'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">'users'</span>, &#123;</span><br><span class="line">    name: req.params.name</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>
<p>通过调用 <code>res.render</code> 函数渲染 ejs 模板。</p>
<p><code>res.render</code> 第一个参数是模板的名字，这里是 <code>users</code> 则会匹配 <code>views/users.ejs</code>，第二个参数是传给模板的数据，这里传入 <code>name</code>，则在 ejs 模板中可使用 <code>name</code>。</p>
<p><code>res.render</code> 的作用就是将模板和数据结合生成 html，同时设置响应头中的 <code>Content-Type: text/html</code>，告诉浏览器我返回的是 html，不是纯文本，要按 html 展示。</p>
<h4 id="ejs-3-种常用标签："><a href="#ejs-3-种常用标签：" class="headerlink" title="ejs 3 种常用标签："></a>ejs 3 种常用标签：</h4><blockquote>
<p><code>&lt;% code %&gt;</code>：运行 JavaScript 代码，不输出<br><code>&lt;%= code %&gt;</code>：显示转义后的 HTML内容<br><code>&lt;%- code %&gt;</code>：显示原始 HTML 内容</p>
</blockquote>
<p><code>&lt;%= code %&gt;</code> 和 <code>&lt;%- code %&gt;</code> 都可以是 JavaScript 表达式生成的字符串。</p>
<p>当变量 <code>code</code> 为普通字符串时，两者没有区别。<br>当 code 比如为 <code>&lt;h1&gt;hello&lt;/h1&gt;</code> 这种字符串时，<code>&lt;%= code %&gt;</code> 会原样输出 <code>&lt;h1&gt;hello&lt;/h1&gt;</code>，而 <code>&lt;%- code %&gt;</code> 则会显示 H1 大的 hello 字符串。</p>
<p><a href="https://www.npmjs.com/package/ejs#tags" target="_blank" rel="noopener">ejs#tags</a></p>
<h4 id="拆分模板组件"><a href="#拆分模板组件" class="headerlink" title="拆分模板组件"></a>拆分模板组件</h4><ul>
<li>模板可复用，减少重复代码</li>
<li>主模板结构清晰</li>
</ul>
<p><strong>views/header.ejs</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      body &#123;padding: 50px;font: 14px "Lucida Grande", Helvetica, Arial, sans-serif;&#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>views/footer.ejs</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>views/users.ejs</strong></p>
<p>在 <code>users.ejs</code> 通过 ejs 内置的 <code>include</code> 方法引入<code>header.ejs</code> 和 <code>footer.ejs</code></p>
<p>(要用 <code>&lt;%- include(&#39;header&#39;) %&gt;</code> 而不是 <code>&lt;%= include(&#39;header&#39;) %&gt;</code>)</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>('<span class="attr">header</span>') %&gt;</span></span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name.toUpperCase</span>() %&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span>hello, <span class="xml"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name</span> %&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>('<span class="attr">footer</span>') %&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="8-中间件"><a href="#8-中间件" class="headerlink" title="8. 中间件"></a>8. 中间件</h3><p><a href="http://expressjs.com/en/4x/api.html#app.use" target="_blank" rel="noopener">app.use([path,] callback [, callback…])</a></p>
<p>express 中的<code>中间件（middleware）</code>就是用来处理请求的，当一个中间件处理完，可以通过调用 <code>next()</code> 传递给下一个中间件，如果没有调用 <code>next()</code>，则请求不会往下传递，如内置的 <code>res.render</code>其实就是渲染完 html 直接返回给客户端，没有调用 <code>next()</code>，从而没有传递给下一个中间件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'1'</span>)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'2'</span>)</span><br><span class="line">  res.status(<span class="number">200</span>).end()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">-------------</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>通过 <code>app.use</code> 加载中间件，在中间件中通过 <code>next</code> 将请求传递到下一个中间件，<code>next</code> 可接受一个参数接收错误信息，如果使用了 <code>next(error)</code>，则会返回错误而不会传递到下一个中间件。</p>
<p>中间件的加载顺序很重要。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'1'</span>)</span><br><span class="line">  next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'haha'</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'2'</span>)</span><br><span class="line">  res.status(<span class="number">200</span>).end()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">--------------</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="built_in">Error</span>: haha</span><br></pre></td></tr></table></figure>
<p><a href="https://www.jianshu.com/p/ea0122ad1ac0" target="_blank" rel="noopener">Express 中间件—-body-parser</a></p>
<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><p><a href="http://expressjs.com/en/guide/error-handling.html" target="_blank" rel="noopener">Error Handling</a></p>
<p>express 内置了一个默认的错误处理器，假如我们想手动控制返回的错误内容，则需要加载一个自定义错误处理的中间件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'1'</span>)</span><br><span class="line">  next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'haha'</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'2'</span>)</span><br><span class="line">  res.status(<span class="number">200</span>).end()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//错误处理</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err.stack)</span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">'Something broke!'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">Something broke!</span><br></pre></td></tr></table></figure>
<h3 id="9-配置文件config-lite"><a href="#9-配置文件config-lite" class="headerlink" title="9. 配置文件config-lite"></a>9. 配置文件config-lite</h3><p><a href="https://www.npmjs.com/package/config-lite" target="_blank" rel="noopener">config-lite</a></p>
<pre><code>A super simple &amp; flexible &amp; intuitive config module, support yaml &amp; toml.
</code></pre><p><code>config-lite</code> 是一个轻量的读取配置文件的模块。<code>config-lite</code> 会根据<code>环境变量（NODE_ENV）</code>的不同加载 config 目录下不同的配置文件。如果不设置<code>NODE_ENV</code>，则读取默认的 default 配置文件，如果设置了 <code>NODE_ENV</code>，则会合并指定的配置文件和 default 配置文件作为配置，<code>config-lite</code> 支持 <code>.js、.json、.node、.yml、.yaml</code>后缀的文件(依次降级查找并合并 default 配置)。</p>
<p>例子：如果程序以 NODE_ENV=production node app 启动，则 config-lite 会依次降级查找 config/production.js、config/production.json、config/production.node、config/production.yml、config/production.yaml 并合并 default 配置。</p>
<h3 id="10-会话"><a href="#10-会话" class="headerlink" title="10. 会话"></a>10. 会话</h3><p>由于 HTTP 协议是无状态的协议，所以服务端需要记录用户的状态时，就需要用某种机制来识别具体的用户，这个机制就是<code>会话（Session）</code>。</p>
<h4 id="cookie-与-session-的区别"><a href="#cookie-与-session-的区别" class="headerlink" title="cookie 与 session 的区别"></a>cookie 与 session 的区别</h4><ul>
<li>cookie 存储在浏览器（有大小限制），session 存储在服务端（没有大小限制）</li>
<li>通常 session 的实现是基于 cookie 的，session id 存储于 cookie 中 session 更安全，cookie可以直接在浏览器查看甚至编辑</li>
</ul>
<p><a href="https://www.zhihu.com/question/19786827" target="_blank" rel="noopener">COOKIE和SESSION有什么区别？</a></p>
<ul>
<li>Session是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中；</li>
<li>Cookie是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现Session的一种方式。</li>
</ul>
<h4 id="express-session-中间件"><a href="#express-session-中间件" class="headerlink" title="express-session 中间件"></a>express-session 中间件</h4><p>引入中间件，实现对会话的支持.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(options))</span><br></pre></td></tr></table></figure>
<p>session 中间件会在 req 上添加 session 对象，即 <code>req.session</code> 初始值为 <code>{}</code>，当我们登录后设置 <code>req.session.user = 用户信息</code>，返回浏览器的头信息中会带上 <code>set-cookie</code> 将 <code>session id</code> 写到浏览器 cookie 中，那么该用户下次请求时，通过带上来的 cookie 中的 <code>session id</code> 我们就可以查找到该用户，并将用户信息保存到 <code>req.session.user</code>。</p>
<h4 id="connect-flash中间件"><a href="#connect-flash中间件" class="headerlink" title="connect-flash中间件"></a>connect-flash中间件</h4><p>引入中间件，实现页面通知只显示一次，刷新后消失。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install connect-flash</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The flash is a special area of the session used for storing messages. Messages are written to the flash and cleared after being displayed to the user. The flash is typically used in combination with redirects, ensuring that the message is available to the next page that is to be rendered.</p>
</blockquote>
<p>它是基于 session 实现的，设置初始值 <code>req.session.flash={}</code>，通过 <code>req.flash(name, value)</code> 设置这个对象下的字段和值，通过 <code>req.flash(name)</code> 获取这个对象下的值，同时删除这个字段，实现了只显示一次刷新后消失的功能。</p>
<h4 id="express-session、connect-mongo-和-connect-flash-的区别与联系"><a href="#express-session、connect-mongo-和-connect-flash-的区别与联系" class="headerlink" title="express-session、connect-mongo 和 connect-flash 的区别与联系"></a>express-session、connect-mongo 和 connect-flash 的区别与联系</h4><blockquote>
<p><strong>express-session</strong>: 会话（session）支持中间件<br><strong>connect-mongo</strong>: 将 session 存储于 mongodb，需结合 express-session 使用，我们也可以将 session 存储于 redis，如 connect-redis<br><strong>connect-flash</strong>: 基于 session 实现的用于通知功能的中间件，需结合 express-session 使用</p>
</blockquote>
<h3 id="11-objectid-to-timestamp"><a href="#11-objectid-to-timestamp" class="headerlink" title="11. objectid-to-timestamp"></a>11. objectid-to-timestamp</h3><p>addCreatedAt 自定义插件（通过 _id 生成时间戳）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">lib/mongo.js</span><br><span class="line">------------</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>)</span><br><span class="line"><span class="keyword">const</span> objectIdToTimestamp = <span class="built_in">require</span>(<span class="string">'objectid-to-timestamp'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 id 生成创建时间 created_at</span></span><br><span class="line">mongolass.plugin(<span class="string">'addCreatedAt'</span>, &#123;</span><br><span class="line">  afterFind: <span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</span><br><span class="line">    results.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">      item.created_at = moment(objectIdToTimestamp(item._id)).format(<span class="string">'YYYY-MM-DD HH:mm'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line">  &#125;,</span><br><span class="line">  afterFindOne: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">      result.created_at = moment(objectIdToTimestamp(result._id)).format(<span class="string">'YYYY-MM-DD HH:mm'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>24 位长的 ObjectId 前 4 个字节是精确到秒的时间戳，所以我们没有额外的存创建时间（如: createdAt）的字段。</p>
<p>ObjectId 生成规则</p>
<figure class="image-box">
                <img src="http://ww1.sinaimg.cn/large/789d050dly1fujpninp8lj209g019dg4.jpg" alt="ObjectId 生成规则" title="" class="">
                <p>ObjectId 生成规则</p>
            </figure>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-04-04T02:28:29.229Z" itemprop="dateUpdated">2019-04-04 10:28:29</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2018/08/15/Node.js (一) Express/" target="_blank" rel="external">https://renkoq.github.io/2018/08/15/Node.js (一) Express/</a>
        
    </div>
    <footer>
        <a href="https://renkoq.github.io">
            <img src="/img/avatar.jpg" alt="Renko">
            Renko
        </a>
    </footer>
</blockquote>

        
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后台/">后台</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://renkoq.github.io/2018/08/15/Node.js (一) Express/&title=《Node.js (一) Express》 — Renko's blog&pic=https://renkoq.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://renkoq.github.io/2018/08/15/Node.js (一) Express/&title=《Node.js (一) Express》 — Renko's blog&source=https://github.com/nswbmw/N-blog/
1. 环境变量环境变量（environment variables）一般是指在操作系统..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Node.js (一) Express》 — Renko's blog&url=https://renkoq.github.io/2018/08/15/Node.js (一) Express/&via=https://renkoq.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://renkoq.github.io/2018/08/15/Node.js (一) Express/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            
    <div id="comment"></div>


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/08/16/Node.js（二） promise/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Node.js（二） promise</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/07/27/JWT规范/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">JWT规范</h4>
      </a>
    </div>
  
</nav>


    
</article>


</div>

        <footer class="footer">
    
    <div class="bottom">
        <p>
            <span>
                Renko &copy; 2016 - 2019
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://renkoq.github.io/2018/08/15/Node.js (一) Express/&title=《Node.js (一) Express》 — Renko's blog&pic=https://renkoq.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://renkoq.github.io/2018/08/15/Node.js (一) Express/&title=《Node.js (一) Express》 — Renko's blog&source=https://github.com/nswbmw/N-blog/
1. 环境变量环境变量（environment variables）一般是指在操作系统..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Node.js (一) Express》 — Renko's blog&url=https://renkoq.github.io/2018/08/15/Node.js (一) Express/&via=https://renkoq.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://renkoq.github.io/2018/08/15/Node.js (一) Express/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLElEQVR42u3awW7rMAwEwP7/T+ddC7za2aXSApbGpyCJZY0PBCny6yu+Xt+u/7+5//77r1er3X//sQsDA+OxjNftlf+nxSfs4rkYGBgHMK42kX+++vU+sCbI+71hYGBgzLabpH2z52JgYGCsMNrQ3K6MgYGBkRST90u3p2FJIP6VWhwDA+OBjHwTf//5V/obGBgYj2K8yisvUPPGQBtkf9gVBgbG1ow8wLVtyyRk568paY5iYGDsymjHLPKD/hk7Ccd1aoiBgbEF47MtyZVwPDuGw8DAOIGRD2/lA171VkZpaL0JDAyMhzPaYYs8aM4C9HDMAgMDYztGkvblhWXbepwdzBXLYWBgbMdoC9f1f64ftP3Q38DAwNia0Q49rAxPzDb65rkYGBjHMNYTu7aR0Caal2kiBgbGpoxZepengPm97REbBgbGOYz1tmKeOK4kl8MMFwMD4xhGm8zljDZZrBNEDAyMjRizkrUd0WjbA3UtjoGBsTUjD20rh2htC6FubWJgYBzGWDlcy19HCy6GLTAwMLZmJAFxdleS9q08EQMD4wTGp5aetTzzQvpNEYuBgbEd41VeeaLWhtfk3st1MDAwtmasB7s8QUyO52bBHQMD4wTGbAxiNgrWUotGJgYGxgGMvHBtk7wZb1jKYmBgYHx0CGM2/vWmIsfAwMBYaE+2qWF9kIeBgXEAoy1NZ8lfHqCTV4yBgXEOIy8dkyC4smbeThg2NTEwMJ7H+AetMyLg+CSNHAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.1.2"></script>

<script type="text/javascript" src="https://cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.1.2"></script>
<script type="text/javascript" src="/js/blog.js?v=1.1.2"></script>

<!-- third-party -->





<script type="text/javascript" src="/js/plugins/local_search.js?v=1.1.2"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



    
        <script type="text/javascript" src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script type="text/javascript" src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script type="text/javascript" src="/js/plugins/valine.js?v=1.1.2"></script>
    



<script type="text/javascript" src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
<script type="text/javascript" src="/js/plugins/leancloud_visitors.js?v=1.1.2"></script>



    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>




    
</body>
</html>
